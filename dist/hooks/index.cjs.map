{"version":3,"sources":["../../src/hooks/index.ts","../../src/hooks/use-form-mutation.ts"],"sourcesContent":["/**\n * @famgia/omnify-react/hooks\n *\n * React hooks for form handling and data mutations\n */\n\nexport { useFormMutation, type UseFormMutationOptions } from './use-form-mutation';\n","/**\n * useFormMutation - Form mutation with auto Laravel error handling\n *\n * @example\n * ```typescript\n * import { useFormMutation } from '@famgia/omnify-react/hooks';\n *\n * const mutation = useFormMutation({\n *   form,\n *   mutationFn: (data) => axios.post('/api/customers', data),\n *   invalidateKeys: [['customers']],\n *   successMessage: '保存しました',\n * });\n *\n * <Form form={form} onFinish={mutation.mutate}>\n *   ...\n *   <Button loading={mutation.isPending}>保存</Button>\n * </Form>\n * ```\n */\n\nimport { useMutation, useQueryClient } from '@tanstack/react-query';\nimport { App } from 'antd';\nimport type { FormInstance } from 'antd';\n\n// =============================================================================\n// Types\n// =============================================================================\n\nexport interface UseFormMutationOptions<TData, TResult> {\n  /** Ant Design form instance */\n  form: FormInstance;\n  /** API call function */\n  mutationFn: (data: TData) => Promise<TResult>;\n  /** Query keys to invalidate on success */\n  invalidateKeys?: readonly (readonly unknown[])[];\n  /** Success message to show */\n  successMessage?: string;\n  /** Callback on success */\n  onSuccess?: (data: TResult) => void;\n  /** Callback on error */\n  onError?: (error: unknown) => void;\n}\n\n// =============================================================================\n// Laravel Error Helpers\n// =============================================================================\n\n/**\n * Parse Laravel validation errors to Ant Design form format\n */\nfunction getFormErrors(error: unknown): { name: string; errors: string[] }[] {\n  const data = (error as any)?.response?.data;\n  const errors = data?.errors;\n\n  if (!errors || typeof errors !== 'object') return [];\n\n  return Object.entries(errors).map(([name, messages]) => ({\n    name,\n    errors: Array.isArray(messages) ? messages : [String(messages)],\n  }));\n}\n\n/**\n * Get general validation message from Laravel response\n */\nfunction getValidationMessage(error: unknown): string | null {\n  const data = (error as any)?.response?.data;\n  return data?.message || null;\n}\n\n// =============================================================================\n// Hook\n// =============================================================================\n\nexport function useFormMutation<TData, TResult = unknown>({\n  form,\n  mutationFn,\n  invalidateKeys = [],\n  successMessage,\n  onSuccess,\n  onError,\n}: UseFormMutationOptions<TData, TResult>) {\n  const queryClient = useQueryClient();\n  const { message } = App.useApp();\n\n  return useMutation({\n    mutationFn,\n    onSuccess: (data) => {\n      // Invalidate queries\n      invalidateKeys.forEach((key) => {\n        queryClient.invalidateQueries({ queryKey: [...key] });\n      });\n\n      // Show success message\n      if (successMessage) {\n        message.success(successMessage);\n      }\n\n      // Custom callback\n      onSuccess?.(data);\n    },\n    onError: (error) => {\n      // Set form field errors from Laravel validation\n      const formErrors = getFormErrors(error);\n      if (formErrors.length > 0) {\n        form.setFields(formErrors);\n      }\n\n      // Show general error message\n      const validationMessage = getValidationMessage(error);\n      if (validationMessage) {\n        message.error(validationMessage);\n      }\n\n      // Custom callback\n      onError?.(error);\n    },\n  });\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACqBA,yBAA4C;AAC5C,kBAAoB;AA6BpB,SAAS,cAAc,OAAsD;AAC3E,QAAM,OAAQ,OAAe,UAAU;AACvC,QAAM,SAAS,MAAM;AAErB,MAAI,CAAC,UAAU,OAAO,WAAW,SAAU,QAAO,CAAC;AAEnD,SAAO,OAAO,QAAQ,MAAM,EAAE,IAAI,CAAC,CAAC,MAAM,QAAQ,OAAO;AAAA,IACvD;AAAA,IACA,QAAQ,MAAM,QAAQ,QAAQ,IAAI,WAAW,CAAC,OAAO,QAAQ,CAAC;AAAA,EAChE,EAAE;AACJ;AAKA,SAAS,qBAAqB,OAA+B;AAC3D,QAAM,OAAQ,OAAe,UAAU;AACvC,SAAO,MAAM,WAAW;AAC1B;AAMO,SAAS,gBAA0C;AAAA,EACxD;AAAA,EACA;AAAA,EACA,iBAAiB,CAAC;AAAA,EAClB;AAAA,EACA;AAAA,EACA;AACF,GAA2C;AACzC,QAAM,kBAAc,mCAAe;AACnC,QAAM,EAAE,QAAQ,IAAI,gBAAI,OAAO;AAE/B,aAAO,gCAAY;AAAA,IACjB;AAAA,IACA,WAAW,CAAC,SAAS;AAEnB,qBAAe,QAAQ,CAAC,QAAQ;AAC9B,oBAAY,kBAAkB,EAAE,UAAU,CAAC,GAAG,GAAG,EAAE,CAAC;AAAA,MACtD,CAAC;AAGD,UAAI,gBAAgB;AAClB,gBAAQ,QAAQ,cAAc;AAAA,MAChC;AAGA,kBAAY,IAAI;AAAA,IAClB;AAAA,IACA,SAAS,CAAC,UAAU;AAElB,YAAM,aAAa,cAAc,KAAK;AACtC,UAAI,WAAW,SAAS,GAAG;AACzB,aAAK,UAAU,UAAU;AAAA,MAC3B;AAGA,YAAM,oBAAoB,qBAAqB,KAAK;AACpD,UAAI,mBAAmB;AACrB,gBAAQ,MAAM,iBAAiB;AAAA,MACjC;AAGA,gBAAU,KAAK;AAAA,IACjB;AAAA,EACF,CAAC;AACH;","names":[]}